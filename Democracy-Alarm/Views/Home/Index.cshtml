@model Democracy_Alarm.Models.VotingCityViewModel
@{
    ViewBag.Title = "Home Page";
}
<!-- Header -->
<header id="portfolio">
    <span class="w3-button w3-hide-large w3-xxlarge w3-hover-text-grey" onclick="w3_open()"><i class="fa fa-bars"></i></span>
    <div class="w3-container">
        <h1><b>縣、市長</b></h1>
        <div class="w3-section w3-bottombar w3-padding-16">
            <!-- <span class="w3-margin-right">Filter:</span>
            <button class="w3-button w3-black">ALL</button>
            <button class="w3-button w3-white"><i class="fa fa-diamond w3-margin-right"></i>Design</button>
            <button class="w3-button w3-white w3-hide-small"><i class="fa fa-photo w3-margin-right"></i>Photos</button>
            <button class="w3-button w3-white w3-hide-small"><i class="fa fa-map-pin w3-margin-right"></i>Art</button> -->
        </div>
    </div>
</header>


<!-- First Grid-->

@{
    var listSize = 3;
    var CountNumber = 0;
    var numberOfLists = Model.CityVotes.Count / listSize;
    for (int listIndex = 0; listIndex < numberOfLists + 1; listIndex++)
    {
        var list = Model.CityVotes.Skip(listIndex * listSize).Take(listSize);
        <div class="w3-row-padding">
            @foreach (var element in list)
            {
                CountNumber++;
                <div class="w3-third w3-container w3-margin-bottom">
                    <div class="w3-container w3-white">
                        <p><b>@element.CityName</b></p>
                        <a class="button line-blue" data-rel="lightcase:myCollection" data="@element.CityName" voting_index="@CountNumber" href="#">
                            <button class="w3-button w3-teal w3-padding-large w3-hover-black">馬上投票</button>
                            </a>

                            <p>總支持數:<span id="VotingCount_@CountNumber">@element.Votes</span> 票</p>
</div>
                </div>
            }
        </div>
    }

}
<!-- Images of Me -->
<div class="w3-row-padding w3-padding-16" id="about">

</div>
<div class="w3-section w3-bottombar w3-padding-16"></div>
<div class="w3-container w3-padding-large" style="margin-bottom:32px">
    <h1><b>理念</b></h1>
    <p>
        馬丁．路德．金：在社會轉型期，最大的悲劇不是
        壞人的囂張，而是好人的過度沉默。
    </p><p>
        現在，民主政治中，選民唯一的武器是一張選票
        ，這張選票的有效期限只有選舉那一天。其他的
        日子，選民只能沉默。所以，現在的狀況如圖
        一。
    </p>
    如果有一個政治家每天努力的做事，我們如何
    持續支持他？
    </p><p>
        一張選票用四年，一季一次，表達與承諾對政治
        家的支持。目標如圖二。
    </p>
    <p><img src="~/Content/Images/presentation1.png" /></p>
    <p><img src="~/Content/Images/presentation2.png" /></p>
    <hr>

    <div class="w3-row-padding w3-padding-16" id="news">

    </div>
    <h1><b>公告</b></h1>
    <!-- Progress bars / Skills -->
    <p>公告11</p>
    <div class="w3-grey">
        <div class="w3-container w3-dark-grey w3-padding">ADFASD ADFADFAS  ADFASDFAS ADFASDF</div>
    </div>
    <p>公告22</p>
    <div class="w3-grey">
        <div class="w3-container w3-dark-grey w3-padding">ADFASD ADFADFAS  ADFASDFAS ADFASDF</div>
    </div>
    <p>公告33</p>
    <div class="w3-grey">
        <div class="w3-container w3-dark-grey w3-padding">ADFASD ADFADFAS  ADFASDFAS ADFASDF</div>
    </div>

    <hr>

    @section scripts {
        <script>
            var LastVotingSeason = '@Model.LastVotingSeason';
            var SelectedIndex = 0;
            jQuery(document).ready(function ($) {
                setup_voting();
            });
            function setup_voting() {
                $('a[data-rel^=lightcase]').on('click', function () {
                    var CityName = this.attributes['data'].value;
                    SelectedIndex = this.attributes['voting_index'].value;
                    $.confirm({
                        title: '投下神聖的一票',
                        content: '' +
                            '<form action="" class="formName">' +
                            '<div class="form-group">' +
                            '<label>投給' + CityName + '-' + LastVotingSeason+'</label>' +
                            '<input type="hidden" id="VotingCity" value="' + CityName+'">' +
                            '<input type="text" id="VotingReason" placeholder="記錄一下投票的原因吧..." class="name form-control" maxlength="120" />' +
                            '</div>' +
                            '</form>'
                        ,
                        closeIcon: true,
                        buttons: {
                            Vote: {
                                text: '我要投票',
                                btnClass: 'btn-orange',
                                action: function () {
                                    SubmitVoting(false);
                                }
                            },
                            GiveUp: {
                                text: '這票作廢',
                                btnClass: 'btn-orange',
                                action: function () {
                                    SubmitVoting(true);
                                }
                            }
                        }
                    });
                });
            }
            function SubmitVoting(IsDiscard) {
                var VotingCity = $("#VotingCity").val();
                var VotingReason = $("#VotingReason").val();
                
                //LastVotingSeason
                //UID
                $.post("@Url.Action("SubmitNewVoting", "Voting", null, Request.Url.Scheme)", {
                    UserID: UID,
                    Target: $("#VotingCity").val(),
                    Season: LastVotingSeason,
                    Comment: $("#VotingReason").val(),
                    IsDiscard: IsDiscard
                }).done(function (data) {
                    //result
                    if (data == 'true') {
                        if (this.data.indexOf("IsDiscard=false") > 0) {
                            $("#VotingCount_" + SelectedIndex).html(parseInt($("#VotingCount_" + SelectedIndex).text()) + 1).css("color","green");
                        }
                    }
                    else {
                        $.alert({
                            title: 'Error',
                            icon: 'fa fa-warning',
                            type: 'red',
                            content: data,
                        });
                    }

                });
            }

        </script>

    }
